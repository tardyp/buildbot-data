(function(){var t;t=function(){function t(){return[]}return t}(),angular.module("bbData",new t)}).call(this),function(){var t;t=function(){function t(t){t.useApplyAsync(!0),t.interceptors.push(["$log","API",function(t,e){return{request:function(n){return 0===n.url.indexOf(e)&&t.debug(n.method+" "+n.url),n}}}])}return t}(),angular.module("bbData").config(["$httpProvider",t])}.call(this),function(){var t;t=function(){function t(){return"api/v2/"}return t}(),angular.module("bbData").constant("API",t())}.call(this),function(){var t;t=function(){function t(){return{FIELDTYPES:{IDENTIFIER:"i",NUMBER:"n"},builds:{id:"buildid",fields:["buildid","builderid","buildrequestid","buildslaveid","complete","complete_at","masterid","number","results","started_at","state_string"],root:!0,paths:["changes","properties","steps","steps/i:name","steps/i:name/logs","steps/i:name/logs/i:slug","steps/i:name/logs/i:slug/contents","steps/i:name/logs/i:slug/raw","steps/n:number","steps/n:number/logs","steps/n:number/logs/i:slug","steps/n:number/logs/i:slug/contents","steps/n:number/logs/i:slug/raw"],"static":{complete:!0}},builders:{id:"builderid",identifier:"name",fields:["builderid","description","name","tags"],root:!0,paths:["forceschedulers","buildrequests","masters","masters/n:masterid","buildslaves","buildslaves/i:name","buildslaves/n:buildslaveid","builds","builds/n:number","builds/n:number/steps","builds/n:number/steps/i:name","builds/n:number/steps/i:name/logs","builds/n:number/steps/i:name/logs/i:slug","builds/n:number/steps/i:name/logs/i:slug/contents","builds/n:number/steps/i:name/logs/i:slug/raw","builds/n:number/steps/n:number","builds/n:number/steps/n:number/logs","builds/n:number/steps/n:number/logs/i:slug","builds/n:number/steps/n:number/logs/i:slug/contents","builds/n:number/steps/n:number/logs/i:slug/raw"],"static":!0},buildrequests:{id:"buildrequestid",fields:["buildrequestid","builderid","buildsetid","claimed","claimed_at","claimed_by_masterid","complete","complete_at","priority","results","submitted_at","waited_for"],root:!0,paths:["builds"],"static":{complete:!0}},buildsets:{id:"bsid",fields:["bsid","complete","complete_at","external_idstring","parent_buildid","parent_relationship","reason","results","sourcestamps","submitted_at"],root:!0,paths:["properties"],"static":{complete:!0}},buildslaves:{id:"buildslaveid",fields:["buildslaveid","configured_on","connected_to","name","slaveinfo"],root:!0,paths:[],"static":!0},changes:{id:"changeid",fields:["changeid","author","branch","category","codebase","comments","files","parent_changeids","project","properties","repository","revision","revlink","sourcestamp","when_timestamp"],root:!0,paths:[],"static":!0},changesources:{id:"changesourceid",fields:["changesourceid","master","name"],root:!0,paths:[],"static":!0},forceschedulers:{id:"name",fields:["name","all_fields","builder_names","label"],root:!0,paths:[],"static":!0},masters:{id:"masterid",fields:["masterid","active","last_active","name"],root:!0,paths:["builders","builders/n:builderid","builders/n:builderid/buildslaves","builders/n:builderid/buildslaves/n:buildslaveid","builders/n:builderid/buildslaves/i:name","buildslaves","buildslaves/i:name","buildslaves/n:buildslaveid","changesources","changesources/n:changesourceid","schedulers","schedulers/n:schedulerid"],"static":!0},schedulers:{id:"schedulerid",fields:["schedulerid","master","name"],root:!0,paths:[],"static":!0},sourcestamps:{id:"ssid",fields:["ssid","branch","codebase","created_at","patch","project","repository","revision"],root:!0,paths:["changes"],"static":!0},steps:{id:"stepid",identifier:"name",fields:["stepid","buildid","complete","complete_at","hidden","name","number","results","started_at","state_string","urls"],root:!1,paths:["logs","logs/i:slug","logs/i:slug/contents","logs/i:slug/raw"],"static":{complete:!0}},logs:{id:"logid",identifier:"slug",fields:["logid","complete","name","num_lines","slug","stepid","type"],root:!1,paths:["contents","raw"],"static":{complete:!0}},contents:{id:null,fields:["logid","logchunks","firstline"],root:!1,restField:"logchunks"},properties:{id:null,fields:[],root:!1}}}return t}(),angular.module("bbData").constant("SPECIFICATION",t())}.call(this),function(){var t,e=[].slice;t=function(){function t(){n=this}var n;return n=null,t.prototype.number=function(t,e){var n;return null==t&&(t=0),null==e&&(e=100),n=Math.random()*(e-t)+t,Math.floor(n)},t.prototype.ids={},t.prototype.id=function(t){var e;return null==t&&(t=""),null==(e=n.ids)[t]&&(e[t]=0),n.ids[t]++},t.prototype["boolean"]=function(){return Math.random()<.5},t.prototype.timestamp=function(t){var e;return null==t&&(t=Date.now()),e=new Date(t+n.number(1,1e6)),Math.floor(e.getTime()/1e3)},t.prototype.string=function(t){return null!=t&&t++,n.number(100,Number.MAX_VALUE).toString(36).substring(0,t)},t.prototype.array=function(){var t,r,i,o,u,s,a;for(i=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],a=n.number(1,10),r=[],o=u=1,s=a;s>=1?s>=u:u>=s;o=s>=1?++u:--u)r.push(i.apply(null,t));return r},t}(),angular.module("bbData").service("generatorService",[t])}.call(this),function(){var t,e=[].slice;t=function(){function t(){n={cache:this.cache}}var n;return t.prototype.cache=!0,n=null,t.prototype.$get=function(t,r,i,o,u,s,a,l,c,p){var f;return new(f=function(){function t(){var t;l=this,angular.extend(this,n),t=Object.keys(p).filter(function(t){return null!=p[t].id}),this.constructor.generateEndpoints(t)}var l;return l=null,t.prototype.clearCache=function(){return c.clear().then(function(){return r.has("$state")?r.get("$state").reload():r.has("$route")?r.get("$route").reload():o.location.reload()})},t.prototype.get=function(){var t,n,r,i,o;return t=1<=arguments.length?e.call(arguments,0):[],i=this.processArguments(t),o=i[0],r=i[1],null==r.subscribe&&(r.subscribe=!1),n=this.createCollection(o,r),n.subscribe()},t.prototype.mocks={},t.prototype.spied=!1,t.prototype.when=function(){var t,n,r,i,o,u;return t=1<=arguments.length?e.call(arguments,0):[],u=t[0],r=t[1],o=t[2],null==o&&(i=[{},r],r=i[0],o=i[1]),"undefined"==typeof jasmine||null===jasmine||this.spied||(spyOn(this,"get").and.callFake(this._mockGet),this.spied=!0),null==(n=this.mocks)[u]&&(n[u]={}),this.mocks[u][r]=o},t.prototype._mockGet=function(){var t,n,r,o,u,s,a,l,c,p;if(t=1<=arguments.length?e.call(arguments,0):[],s=this.processArguments(t),p=s[0],o=s[1],u=angular.copy(o),delete u.subscribe,c=(null!=(a=this.mocks[p])?a[o]:void 0)||(null!=(l=this.mocks[p])?l[u]:void 0),null==c)throw new Error("No return value for: "+p+" ("+angular.toJson(o)+")");return n=this.createCollection(p,o),n.from(c),r=i.resolve(n),r.getArray=function(){return n},r},t.prototype.createCollection=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e);return Object(i)===i?i:r}(u,t,function(){})},t.prototype.processArguments=function(t){var e,n,r;return t.filter(function(t){return null!=t}),e=t[t.length-1],angular.isObject(e)&&(n=t.pop()),r=a.restPath(t),[r,n||{}]},t.prototype.control=function(t,e,n){return null==n&&(n={}),null==this.jsonrpc&&(this.jsonrpc=1),s.post(t,{id:this.jsonrpc++,jsonrpc:"2.0",method:e,params:n})},t.generateEndpoints=function(t){return t.forEach(function(t){return function(n){var r;return r=a.capitalize(n),t.prototype["get"+r]=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],l.get.apply(l,[n].concat(e.call(t)))}}}(this))},t.prototype.open=function(t){var n;return new(n=function(){function n(){var e;this.collections=r,e=Object.keys(p).filter(function(t){return null!=p[t].id}),this.constructor.generateEndpoints(e),null!=t&&this.closeOnDestroy(t)}var r;return r=[],n.prototype.close=function(){return r.forEach(function(t){return"function"==typeof t.unsubscribe?t.unsubscribe():void 0})},n.prototype.closeOnDestroy=function(t){if(!angular.isFunction(t.$on))throw new Error("Parameter 'scope' doesn't have an $on function");return t.$on("$destroy",function(t){return function(){return t.close()}}(this))},n.generateEndpoints=function(t){return t.forEach(function(t){return function(n){var i;return i=a.capitalize(n),t.prototype["get"+i]=function(){var t,n,o;return t=1<=arguments.length?e.call(arguments,0):[],n=t[t.length-1],angular.isObject(n)?null==n.subscribe&&(n.subscribe=!0):t.push({subscribe:!0}),o=l["get"+i].apply(l,t),r.push(o.getArray()),o}}}(this))},n}())},t}())},t.prototype.$get.$inject=["$log","$injector","$q","$window","Collection","restService","dataUtilsService","tabexService","indexedDBService","SPECIFICATION"],t}(),angular.module("bbData").provider("dataService",[t])}.call(this),function(){var t;t=function(){function t(){return{paths:"&[path+query],path,query,lastActive"}}return t}(),angular.module("bbData").constant("DBSTORES",t())}.call(this),function(){var t;t=function(){function t(t){var e;return new(e=function(){function e(){}return e.prototype.capitalize=function(t){return t[0].toUpperCase()+t.slice(1).toLowerCase()},e.prototype.type=function(t){var e;return e=this.copyOrSplit(t),e=e.filter(function(t){return"*"!==t}),e.length%2===0&&e.pop(),e.pop()},e.prototype.singularType=function(t){return this.type(t).replace(/s$/,"")},e.prototype.socketPath=function(t){var e,n;return e=this.copyOrSplit(t),n=["*"],e.length%2===1&&n.push("*"),e.concat(n).join("/")},e.prototype.restPath=function(t){var e;return e=this.copyOrSplit(t),e=e.filter(function(t){return"*"!==t}),e.join("/")},e.prototype.endpointPath=function(t){var e;return e=this.copyOrSplit(t),e=e.filter(function(t){return"*"!==t}),e.length%2===0&&e.pop(),e.join("/")},e.prototype.copyOrSplit=function(t){if(angular.isArray(t))return t.slice(0);if(angular.isString(t))return t.split("/");throw new TypeError("Parameter 'arrayOrString' must be a array or a string, not "+typeof t)},e.prototype.unWrap=function(e,n){var r,i;return i=this.type(n),i=(null!=(r=t[i])?r.restField:void 0)||i,e[i]},e.prototype.parse=function(t){var e,n,r,i;for(r in t){i=t[r];try{t[r]=angular.fromJson(i)}catch(n){e=n}}return t},e.prototype.numberOrString=function(t){var e;return null==t&&(t=null),angular.isNumber(t)?t:(e=parseInt(t,10),isNaN(e)?t:e)},e.prototype.emailInString=function(t){var e;if(!angular.isString(t))throw new TypeError("Parameter 'string' must be a string, not "+typeof t);return e=/[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/,e.exec(t).pop()||""},e}())}return t}(),angular.module("bbData").service("dataUtilsService",["SPECIFICATION",t])}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n=[].slice;t=function(){function t(t,r,i,o,u,s,a){var l;return new(l=function(){function r(){var e;this.db=new o.Dexie("BBCache"),e={},angular.extend(e,this.processSpecification(a),s),this.db.version(1).stores(e),this.db.on("error",function(e){return t.error(e)}),this.open()}return r.prototype.open=function(){return i(function(e){return function(n){return e.db.open()["catch"](function(e){return t.error("indexedDBService: open",e)})["finally"](function(){return n()})}}(this))},r.prototype.clear=function(){return i(function(e){return function(n){return e.db["delete"]()["catch"](function(e){return t.error("indexedDBService: clear",e)})["finally"](function(){return e.open().then(function(){return n()})})}}(this))},r.prototype.get=function(t,e){return null==e&&(e={}),i(function(n){return function(r,i){return n.processUrl(t).then(function(t){var i,o,s,l;return l=t[0],o=t[1],i=t[2],angular.extend(e,o),null==a[l]?void r([]):(s=n.db[l],n.db.transaction("r",s,function(){return null!=i?void s.get(i).then(function(t){return r(u.parse(t))}):s.toArray().then(function(t){var i,o,s,a,c,p,f,h;t=t.map(function(t){return u.parse(t)}),s=[];for(i in e)h=e[i],["field","limit","offset","order"].indexOf(i)<0&&(s[i]=h);return t=n.filter(t,s,l),p=null!=e?e.order:void 0,t=n.sort(t,p),c=null!=e?e.offset:void 0,a=null!=e?e.limit:void 0,t=n.paginate(t,c,a),f=null!=e?e.property:void 0,t=n.properties(t,f),o=null!=e?e.field:void 0,t=n.fields(t,o),r(t)})}))})}}(this))},r.prototype.filter=function(t,n,r){return t.filter(function(t){var r,i,o,u,s,a;for(o in n){switch(a=n[o],["on","true","yes"].indexOf(a)>-1?a=!0:["off","false","no"].indexOf(a)>-1&&(a=!1),s=o.split("__"),i=s[0],u=s[1],u){case"ne":r=t[i]!==a;break;case"lt":r=t[i]<a;break;case"le":r=t[i]<=a;break;case"gt":r=t[i]>a;break;case"ge":r=t[i]>=a;break;default:r=t[i]===a||angular.isArray(t[i])&&e.call(t[i],a)>=0||t["_"+i]===a||angular.isArray(t["_"+i])&&e.call(t["_"+i],a)>=0}if(!r)return!1}return!0})},r.prototype.sort=function(t,e){var n,r;return n=function(t){var e;return"-"===t[0]&&(t=t.slice(1),e=!0),function(n,r){var i;return e&&(i=[r,n],n=i[0],r=i[1]),n[t]<r[t]?-1:n[t]>r[t]?1:0}},r=t.slice(0),angular.isString(e)?r.sort(n(e)):angular.isArray(e)&&r.sort(function(t,r){var i,o,u,s;for(o=0,u=e.length;u>o;o++)if(s=e[o],i=n(s)(t,r))return i;return 0}),r},r.prototype.paginate=function(t,e,n){var r;return null==e&&(e=0),e>=t.length?[]:(r=null==n||e+n>t.length?t.length:e+n-1,t.slice(e,+r+1||9e9))},r.prototype.properties=function(t,e){return t},r.prototype.fields=function(t,n){var r,i,o,u;if(null==n)return t;for(angular.isArray(n)||(n=[n]),i=0,u=t.length;u>i;i++){r=t[i];for(o in r)e.call(n,o)<0&&delete r[o]}return t},r.prototype.processUrl=function(t){return i(function(e){return function(r,i){var o,s,l,c,p,f,h,d,g,b,m,y,v,S,E,w,A,k,_,P,O;if(S=t.split("/"),k=S[0],c=S[1],m=3<=S.length?n.call(S,2):[],_=a[k],v={},0===m.length)return c=u.numberOrString(c),angular.isString(c)&&_.identifier&&(v[_.identifier]=c,c=null),void r([k,v,c]);if(y=m.join("/"),p=_.paths.filter(function(t){var e;return e=t.replace(RegExp(a.FIELDTYPES.IDENTIFIER+"\\:\\w+","g"),"[a-zA-Z]+").replace(RegExp(a.FIELDTYPES.NUMBER+"\\:\\w+","g"),"\\d+"),RegExp("^"+e+"$").test(y)}).pop(),null==p)throw new Error("No child path ("+m.join("/")+") found for root ("+k+")");return p=p.split("/"),m.length%2===0&&(l=u.numberOrString(m.pop()),E=p.pop().split(":"),s=E[0],o=E[1]),O=m.pop(),p.pop(),d=u.numberOrString(m.pop()||c),h=(null!=(w=p.pop())?w.split(":").pop():void 0)||a[k].id,b=p.pop()||k,g=a[b].id,o===(null!=(A=a[O])?A.id:void 0)?(c=l,r([O,v,c])):h!==g?(P=t.split("/"),f=P.slice(0,P.length%2===0?-2:-1).join("/"),e.get(f).then(function(t){return v[g]=t[0][g],null!=o&&(v[o]=l),r([O,v,null])})):(v[h]=d,null!=o&&(v[o]=l),r([O,v,null]))}}(this))},r.prototype.processSpecification=function(t){var e,n,r,i,o;o={};for(r in t)i=t[r],angular.isArray(i.fields)&&(e=i.fields.slice(0),n=e.indexOf(i.id),n>-1?e[n]="&"+e[n]:e.unshift("++id"),o[r]=e.join(","));return o},r}())}return t}(),angular.module("bbData").service("indexedDBService",["$log","$injector","$q","$window","dataUtilsService","DBSTORES","SPECIFICATION",t])}.call(this),function(){var t,e=[].slice;t=function(){function t(t,n,r){var i;return new(i=function(){function i(){}return i.prototype.execute=function(e){return n(function(n){return function(n,r){return t(e).success(function(t){var e,i,o;try{return e=angular.fromJson(t),n(e)}catch(o){return i=o,r(i)}}).error(function(t){return r(t)})}}(this))},i.prototype.get=function(t,e){var n;return null==e&&(e={}),n={method:"GET",url:this.parse(r,t),params:e,headers:{Accept:"application/json"}},this.execute(n)},i.prototype.post=function(t,e){var n;return null==e&&(e={}),n={method:"POST",url:this.parse(r,t),data:e,headers:{"Content-Type":"application/json"}},this.execute(n)},i.prototype.parse=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],t.join("/").replace(/\/\//,"/")},i}())}return t}(),angular.module("bbData").service("restService",["$http","$q","API",t])}.call(this),function(){var t;t=function(){function t(t,e,n,r,i){var o;return new(o=function(){function o(){}return o.prototype.queue=[],o.prototype.deferred={},o.prototype.onMessage=null,o.prototype.onClose=null,o.prototype.open=function(){return null==this.socket&&(this.socket=this.getWebSocket()),this.socket.onopen=function(t){return function(){return t.flush()}}(this),this.socket.onmessage=function(e){return function(n){var r,i,o,u,s,a,l,c,p,f,h;try{return i=angular.fromJson(n.data),t.debug("WS message",i),null!=i._id?(c=[i.msg,i.error,i._id,i.code],n=c[0],u=c[1],a=c[2],r=c[3],200===r?null!=(p=e.deferred[a])?p.resolve(n):void 0:null!=(f=e.deferred[a])?f.reject(u):void 0):(h=[i.k,i.m],l=h[0],n=h[1],"function"==typeof e.onMessage?e.onMessage(l,n):void 0)}catch(s){return o=s,t.error(o)}}}(this),this.socket.onclose=function(t){return function(){return"function"==typeof t.onClose?t.onClose():void 0}}(this)},o.prototype.close=function(){var t;return null!=(t=this.socket)?t.close():void 0},o.prototype.send=function(n){var r,i;return i=this.nextId(),n._id=i,null==(r=this.deferred)[i]&&(r[i]=e.defer()),n=angular.toJson(n),this.socket.readyState===(this.socket.OPEN||1)?(t.debug("WS send",angular.fromJson(n)),this.socket.send(n)):this.queue.push(n),this.deferred[i].promise},o.prototype.flush=function(){var e,n;for(n=[];e=this.queue.shift();)t.debug("WS send",angular.fromJson(e)),n.push(this.socket.send(e));return n},o.prototype.nextId=function(){return null==this.id&&(this.id=0),this.id=this.id<1e3?this.id+1:0,this.id},o.prototype.getUrl=function(){var t,e,r,i;return e=n.host(),i="https"===n.protocol()?"wss":"ws",t="https"===n.protocol()?443:80,r=n.port()===t?"":":"+n.port(),i+"://"+e+r+"/ws"},o.prototype.getWebSocket=function(){var t;return t=this.getUrl(),"undefined"!=typeof jasmine&&null!==jasmine?i.getWebSocket():null!=r.ReconnectingWebSocket?new r.ReconnectingWebSocket(t):new r.WebSocket(t)},o}())}return t}(),angular.module("bbData").service("socketService",["$log","$q","$location","$window","webSocketBackendService",t])}.call(this),function(){var t;t=function(){function t(){n=this,this.webSocket=new e}var e,n;return n=null,t.prototype.sendQueue=[],t.prototype.receiveQueue=[],t.prototype.send=function(t){var e;return e={data:t},this.sendQueue.push(e)},t.prototype.flush=function(){var t,e;for(e=[];t=this.sendQueue.shift();)e.push(this.webSocket.onmessage(t));return e},t.prototype.getWebSocket=function(){return this.webSocket},e=function(){function t(){}return t.prototype.OPEN=1,t.prototype.send=function(t){return n.receiveQueue.push(t)},t.prototype.close=function(){return"function"==typeof this.onclose?this.onclose():void 0},t}(),t}(),angular.module("bbData").service("webSocketBackendService",[t])}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},r=[].slice;t=function(){function t(t,i,o,u,s,a,l,c,p){var f;return new(f=function(){function f(){this.closeHandler=e(this.closeHandler,this),this.messageHandler=e(this.messageHandler,this),this.refreshHandler=e(this.refreshHandler,this),this.masterHandler=e(this.masterHandler,this),s.onMessage=this.messageHandler,s.onClose=this.closeHandler,this.initialRoleDeferred=o.defer(),this.initialRole=this.initialRoleDeferred.promise,this.client.on(h.MASTER,this.masterHandler),this.client.on(h.REFRESH,this.refreshHandler),i.onunload=i.onbeforeunload=function(t){return function(e){return t.activatePaths(),null}}(this)}var h,d,g;return h={MASTER:"!sys.master",REFRESH:"!sys.channels.refresh"},g={MASTER:"bb.role.master",SLAVE:"bb.role.slave"},f.prototype._ROLES=g,d={READY:"bb.event.ready",UPDATE:"bb.event.update",NEW:"bb.event.new"},f.prototype.EVENTS=d,f.prototype.client=i.tabex.client(),f.prototype.getSpecification=function(t){return p[t]},f.prototype.masterHandler=function(t){return t.node_id===t.master_id?(this.role=g.MASTER,this.initialRoleDeferred.resolve(),s.open()):(this.role=g.SLAVE,this.initialRoleDeferred.resolve(),s.close())},f.prototype.refreshHandler=function(t){return this.initialRole.then(function(e){return function(){return e.role===g.MASTER?e.masterRefreshHandler(t):void 0}}(this))},f.prototype.debounceTimeout=100,f.prototype.trackedPaths={},f.prototype.consuming={},f.prototype.masterRefreshHandler=function(e){return null!=this.timeoutPromise&&u.cancel(this.timeoutPromise),this.timeoutPromise=u(function(n){return function(){return n.activatePaths().then(function(){var r,i,o,u,s,a,l,c,p;for(i=e.channels.filter(function(t){return 0!==t.indexOf("!sys.")}),c={},s=0,a=i.length;a>s;s++){r=i[s];try{p=angular.fromJson(r),null==c[l=p.path]&&(c[l]=[]),c[p.path].push(p.query)}catch(u){return o=u,void t.error("channel is not a JSON string",r)}}return n.startConsumingAll(c).then(function(){var t;for(t in n.consuming)t in c||(n.stopConsuming(t),delete n.consuming[t]);return n.trackedPaths=c,n.loadAll(c)})})}}(this),this.debounceTimeout)},f.prototype.messageHandler=function(t,e){var n,r,i,o;return i=t.split("/").slice(-3),o=i[0],r=i[1],n=i[2],n="new"===n?d.NEW:d.UPDATE,c.db[o].put(e).then(function(e){return function(){var r,i,o;o=[];for(r in e.trackedPaths)RegExp("^"+r.replace(/\*/g,"(\\w+|\\d+)")+"$").test(t)?o.push(function(){var t,e,o,u;for(o=this.trackedPaths[r],u=[],t=0,e=o.length;e>t;t++)i=o[t],u.push(this.emit(r,i,n));return u}.call(e)):o.push(void 0);return o}}(this))},f.prototype.closeHandler=function(){var t;return t=angular.copy(this.trackedPaths),this.trackedPaths={},this.startConsumingAll(t)},f.prototype.loadAll=function(t){var e;return e=c.db,e.paths.toArray().then(function(e){return function(n){var r,i,o,u;u=[];for(r in t)i=t[r],u.push(function(){var t,e,u;for(u=[],t=0,e=i.length;e>t;t++)o=i[t],u.push(this.load(r,o,n));return u}.call(e));return u}}(this))},f.prototype.load=function(e,r,i){return null==i&&(i=[]),o(function(t){return function(o,u){var s,f,h,d,g,b,m,y,v,S,E,w,A,k,_;for(f=c.db,_=l.type(e),k=t.getSpecification(_),b=0,m=i.length;m>b;b++)if(h=i[b],h.query=angular.fromJson(h.query),g=h.path===e&&(angular.equals(h.query,r)||angular.equals(h.query,{}))||h.path===_&&angular.equals(h.query,{}),d=new Date-new Date(h.lastActive),s=2e3>d||k["static"]===!0,g&&s)return void o();return A=l.restPath(e),E=t.getParent(A),S=E[0],y=E[1],v=null!=(w=p[S])?w.id:void 0,null!=v&&(v="_"+v),a.get(A,r).then(function(t){var i;return i=l.type(A),t=l.unWrap(t,i),f.transaction("rw",f[i],function(){return angular.isArray(t)||(t=[t]),t.forEach(function(t){var e,r,o,u;return o=function(t){var e,n;for(e in t)n=t[e],angular.isObject(t[e])&&(t[e]=angular.toJson(n));return f[i].put(t)},r=null!=(u=p[i])?u.id:void 0,e=t[r],null!=e?f[i].get(e).then(function(e){var r,i;e=l.parse(e);for(r in t)i=t[r],e[r]=i;return null!=v&&(null==e[v]&&(e[v]=[]),n.call(e[v],y)<0&&e[v].push(y)),o(e)})["catch"](function(){return null!=v&&(t[v]=[y]),o(t)}):(null!=v&&(t[v]=[y]),o(t))})}).then(function(){return f.transaction("rw",f.paths,function(){return f.paths.put({path:e,query:angular.toJson(r)})}).then(function(){return o()})["catch"](function(t){return u(t)})})["catch"](function(t){return u(t)})},function(t){return u(t)})}}(this)).then(function(t){return function(){return t.emit(e,r,d.READY)}}(this),function(e){return function(e){return t.error(e)}}(this))},f.prototype.getParent=function(t){var e,n,r;return r=t.split("/"),r%2===0&&r.pop(),r.pop(),e=l.numberOrString(r.pop()),n=r.pop(),[n,e]},f.prototype.activatePaths=function(){var t,e;return e=angular.copy(this.trackedPaths),t=c.db,t.transaction("rw",t.paths,function(n){return function(){var n,r,i,o,u;n=(new Date).toString(),u=[];for(r in e)i=e[r],u.push(function(){var e,u,s;for(s=[],e=0,u=i.length;u>e;e++)o=i[e],s.push(t.paths.where("[path+query]").equals([r,angular.toJson(o)]).modify({lastActive:n}));return s}());return u}}(this))},f.prototype.on=function(){var t,e,n,i,o,u,s;return i=2<=arguments.length?r.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],o=i[0],u=i[1],u=angular.copy(u)||{},s=u.subscribe,delete u.subscribe,s===!1?void c.db.paths.toArray().then(function(t){return function(e){return t.load(o,u,e).then(function(){return n(d.READY)})}}(this)):(t={path:o,query:u},this.client.on(angular.toJson(t),n))},f.prototype.off=function(){var t,e,n,i,o,u;return i=2<=arguments.length?r.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],o=i[0],u=i[1],u=angular.copy(u)||{},delete u.subscribe,t={path:o,query:u},this.client.off(angular.toJson(t),n)},f.prototype.emit=function(){var t,e,n,i,o,u;return i=2<=arguments.length?r.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],o=i[0],u=i[1],t={path:o,query:u||{}},this.client.emit(angular.toJson(t),n,!0)},f.prototype.startConsuming=function(t){return s.send({cmd:"startConsuming",path:t})},f.prototype.stopConsuming=function(t){return s.send({cmd:"stopConsuming",path:t})},f.prototype.startConsumingAll=function(t){var e,n,r,i,u,s,a,l,c,p,f,h,d,g,b,m,y;if(angular.isArray(t))y=t.slice(0);else{if(!angular.isObject(t))throw new Error("Parameter paths is not an object or an array");y=Object.keys(t)}for(d=[],e=r=0,i=y.length;i>r;e=++r)for(f=y[e],m=RegExp("^"+f.replace(/\*/g,"(\\w+|\\d+|\\*)")+"$"),n=l=0,u=y.length;u>l;n=++l)b=y[n],n!==e&&m.test(b)&&d.push(b);for(c=0,s=d.length;s>c;c++)f=d[c],y.splice(y.indexOf(f),1);for(g=[],p=0,a=y.length;a>p;p++)h=y[p],h in this.trackedPaths||(this.consuming[h]=!0,g.push(this.startConsuming(h)));return o.all(g)},f.prototype.mergePaths=function(t,e){var n,r,i,o;o=[];for(n in e)r=e[n],null==t[n]&&(t[n]=[]),o.push(function(){var e,o,u;for(u=[],e=0,o=r.length;o>e;e++)i=r[e],0===t[n].filter(function(t){return angular.equals(t,i)}).length?u.push(t[n].push(i)):u.push(void 0);return u}());return o},f}())}return t}(),angular.module("bbData").service("tabexService",["$log","$window","$q","$timeout","socketService","restService","dataUtilsService","indexedDBService","SPECIFICATION",t])}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=function(){function t(t,r,o,u,s,a,l){var c;return c=function(c){function p(n,i){var o,s;null==i&&(i={}),this.listener=e(this.listener,this),this.getRestPath=function(){return n},this.getQuery=function(){return i},this.getSocketPath=function(){return u.socketPath(n)},this.getType=function(){return u.type(n)},this.getEndpoint=function(){return u.endpointPath(n)},this.getSpecification=function(){return l[this.getType()]},o=r.get("Wrapper"),this.getWrapper=function(){return o},s=t.defer(),this.getReadyDeferred=function(){return s},this.getReadyPromise=function(){return s.promise}}return n(p,c),p.prototype.subscribe=function(){var t;return s.on(this.getSocketPath(),this.getQuery(),this.listener),t=this.getReadyPromise(),t.getArray=function(t){return function(){return t}}(this),t},p.prototype.unsubscribe=function(){return this.forEach(function(t){return null!=t&&"function"==typeof t.unsubscribe?t.unsubscribe():void 0}),s.off(this.getSocketPath(),this.getQuery(),this.listener)},p.prototype.listener=function(t){var e;if(t!==s.EVENTS.READY||0===this.length)return e=angular.copy(this.getQuery()),delete e.subscribe,a.get(this.getRestPath(),e).then(function(e){return function(n){switch(angular.isArray(n)||(n=[n]),t){case s.EVENTS.READY:return e.readyHandler(n);case s.EVENTS.UPDATE:return e.updateHandler(n);case s.EVENTS.NEW:return e.newHandler(n);default:return o.error("Unhandled tabex event",t)}}}(this))},p.prototype.readyHandler=function(t){var e;return this.from(t),null!=(e=this.getReadyDeferred())?e.resolve(this):void 0},p.prototype.newHandler=function(t){var e,n;return e=this.getSpecification().id,n={"new":t.map(function(t){return t[e]}),old:this.map(function(t){return t[e]})},t.forEach(function(t){return function(r){var o;return o=r[e],i.call(n.old,o)<0?t.add(r):void 0}}(this)),this.forEach(function(t){return function(r){var o;return o=r[e],i.call(n["new"],o)<0?t["delete"](r):void 0}}(this))},p.prototype.updateHandler=function(t){var e,n,r,i,o;for(this.newHandler(t),n=this.getSpecification().id,o=[],r=0,i=t.length;i>r;r++)e=t[r],o.push(this.forEach(function(t){return e[n]===t[n]?t.update(e):void 0}));return o},p.prototype.from=function(t){var e,n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(this.add(e));return i},p.prototype.add=function(t){var e,n;return e=this.getWrapper(),n=new e(t,this.getEndpoint(),this.getQuery().subscribe),this.push(n)},p.prototype.clear=function(){var t;for(t=[];this.length>0;)t.push(this.pop());return t},p.prototype["delete"]=function(t){var e;return e=this.indexOf(t),e>-1?this.splice(e,1):void 0},p}(Array)}return t}(),angular.module("bbData").factory("Collection",["$q","$injector","$log","dataUtilsService","tabexService","indexedDBService","SPECIFICATION",t])}.call(this),function(){var t,e=[].slice;t=function(){function t(t,n,r,i,o){var u;return u=function(){function t(t,e,n){var r;if(this._subscribe=n,!angular.isString(e))throw new TypeError("Parameter 'endpoint' must be a string, not "+typeof e);this._endpoint=e,this.update(t),r=Object.keys(o),this.constructor.generateFunctions(r)}return t.prototype.update=function(t){return angular.merge(this,t)},t.prototype.get=function(){var t,r,i,u,s,a,l,c,p,f,h,d,g,b,m,y,v,S,E;if(t=1<=arguments.length?e.call(arguments,0):[],m=this._endpoint.split("/"),S=m[0],l=m[1],g=3<=m.length?e.call(m,2):[],h=2<=t.length?e.call(t,0,a=t.length-1):(a=0,[]),p=t[a++],angular.isObject(p)?(b=g.concat("*",h).join("/"),null!=this._subscribe&&null==(r=t[t.length-1]).subscribe&&(r.subscribe=this._subscribe)):(b=g.concat("*",t).join("/"),null!=this._subscribe&&t.push({subscribe:this._subscribe})),0===g.length)return n.get.apply(n,[this._endpoint,this.getId()].concat(e.call(t)));if(E=o[S],f=E.paths.filter(function(t){var e;return e=t.replace(/\w+\:\w+/g,"(\\*|\\w+|\\d+)"),RegExp("^"+e+"$").test(b)}).pop(),null==f)d=this.getId();else for(y=f.split("/").slice(0,-1),c=y.length-1;c>=0;c+=-1)if(i=y[c],i.indexOf(":")>-1){v=i.split(":"),s=v[0],u=v[1],d=this[u];break}return n.get.apply(n,[this._endpoint,d].concat(e.call(t)))},t.prototype.control=function(t,e){return n.control(this._endpoint+"/"+(this.getIdentifier()||this.getId()),t,e)},t.generateFunctions=function(t){return t.forEach(function(t){return function(n){var i,o,u,s,a;if(n!==n.toUpperCase())return i=r.capitalize(n),null==(o=t.prototype)[s="get"+i]&&(o[s]=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],this.get.apply(this,[n].concat(e.call(t)))}),null!=(u=t.prototype)[a="load"+i]?u[a]:u[a]=function(){var t,r;return t=1<=arguments.length?e.call(arguments,0):[],r=this.get.apply(this,[n].concat(e.call(t))),this[n]=r.getArray(),r}}}(this))},t.prototype.getId=function(){return this[this.classId()]},t.prototype.getIdentifier=function(){return this[this.classIdentifier()]},t.prototype.classId=function(){return o[r.type(this._endpoint)].id},t.prototype.classIdentifier=function(){return o[r.type(this._endpoint)].identifier},t.prototype.unsubscribe=function(){var t,e,n;n=[];for(t in this)e=this[t],n.push(null!=e&&"function"==typeof e.unsubscribe?e.unsubscribe():void 0);return n},t}()}return t}(),angular.module("bbData").factory("Wrapper",["$log","dataService","dataUtilsService","tabexService","SPECIFICATION",t])}.call(this);
//# sourceMappingURL=scripts.js.map